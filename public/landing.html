<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Offre Spéciale</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root { --primary-color: #dc2626; }
        body { font-family: 'Inter', sans-serif; background-color: #e2e8f0; margin: 0; padding-bottom: 90px; }
        
        .mobile-container {
            max-width: 480px; margin: 0 auto; background: white; min-height: 100vh;
            position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.1); overflow-x: hidden;
            display: flex; flex-direction: column;
        }

        /* Elements */
        .sticky-timer { position: sticky; top: 0; background: #fcd34d; color: #78350f; text-align: center; font-weight: 700; padding: 10px; z-index: 100; }
        .hero-image-container { width: 100%; cursor: pointer; min-height: 300px; background: #cbd5e1; display: flex; align-items: center; justify-content: center; }
        .hero-image { width: 100%; height: auto; display: block; }
        
        .sticky-footer {
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 480px;
            background: linear-gradient(to top, rgba(255,255,255,1) 0%, rgba(255,255,255,0.9) 80%, rgba(255,255,255,0) 100%);
            padding: 15px 20px; z-index: 900; text-align: center;
        }

        /* Modale */
        .custom-modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85);
            z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 15px;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        .custom-modal-overlay.active { opacity: 1; pointer-events: all; }
        .custom-modal-content {
            background: #f8fafc; border-radius: 20px; width: 100%; max-width: 450px;
            max-height: 90vh; overflow-y: auto; transform: translateY(20px);
            transition: transform 0.3s;
        }
        .custom-modal-overlay.active .custom-modal-content { transform: translateY(0); }

        /* Form Styling Large */
        .input-group-text { background: #e2e8f0; border: none; color: #64748b; border-radius: 10px 0 0 10px; }
        .form-control-lg { border: none; background: #e2e8f0; border-radius: 0 10px 10px 0; font-size: 1rem; padding: 14px; }
        .form-control-lg:focus { background: white; box-shadow: 0 0 0 2px #dc2626; }
        .offer-card { background: white; border: 1px solid #cbd5e1; border-radius: 12px; padding: 15px; margin-bottom: 10px; cursor: pointer; }
        .offer-card.selected { border: 2px solid #dc2626; background: #fef2f2; }

        .wa-link { display: inline-block; margin-top: 10px; color: #16a34a; font-weight: 700; text-decoration: none; }
        .d-none { display: none !important; }
    </style>
</head>
<body>

    <div class="mobile-container">
        <div id="timerBar" class="sticky-timer d-none"><i class="fas fa-clock me-1"></i> Offre expire dans <span id="timerCounter">15:00</span></div>
        
        <div class="hero-image-container" onclick="openModal()">
            <img id="heroImage" src="" class="hero-image" style="display:none;">
            <div id="noImage" class="d-none p-5 text-center text-muted"><i class="fas fa-image fa-2x"></i><br>Pas d'image</div>
        </div>

        <div class="sticky-footer">
            <button id="stickyCtaBtn" class="btn btn-danger w-100 py-3 rounded-pill fw-bold shadow-lg text-uppercase" onclick="openModal()">COMMANDER</button>
            <div id="whatsappFooter" class="d-none"><a href="#" id="waLink" target="_blank" class="wa-link"><i class="fab fa-whatsapp me-1"></i> <span id="waText">WhatsApp</span></a></div>
        </div>
    </div>

    <div id="orderModal" class="custom-modal-overlay">
        <div class="custom-modal-content">
            <div class="bg-white p-3 border-bottom sticky-top d-flex justify-content-between align-items-center">
                <h6 class="m-0 fw-bold">Finaliser ma commande</h6>
                <button class="btn btn-sm btn-light rounded-circle" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-4">
                <div class="mb-4">
                    <p class="small fw-bold text-muted text-uppercase mb-2">1. Choisissez votre pack</p>
                    <div id="offersList"></div>
                </div>
                <div>
                    <p class="small fw-bold text-muted text-uppercase mb-2">2. Vos coordonnées</p>
                    <form id="checkoutForm" onsubmit="handleOrderSubmit(event)">
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                            <input type="text" id="inpName" class="form-control form-control-lg" placeholder="Nom Complet" required>
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fas fa-phone"></i></span>
                            <input type="tel" id="inpPhone" class="form-control form-control-lg" placeholder="Téléphone" required>
                        </div>
                        <div class="input-group mb-4">
                            <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                            <input type="text" id="inpCity" class="form-control form-control-lg" placeholder="Ville & Quartier" required>
                        </div>
                        <button type="submit" class="btn btn-success w-100 py-3 fw-bold shadow btn-lg" id="formSubmitBtn">VALIDER</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        let pageData = {};

        document.addEventListener('DOMContentLoaded', () => {
            const dataStr = localStorage.getItem('winkshop_landing_data');
            if(!dataStr) return;
            pageData = JSON.parse(dataStr);
            initPage(pageData);
        });

        function initPage(data) {
            // Visuel
            const img = document.getElementById('heroImage');
            if(data.image) { img.src = data.image; img.style.display = 'block'; }
            else document.getElementById('noImage').classList.remove('d-none');

            // Boutons
            const btn = document.getElementById('stickyCtaBtn');
            btn.textContent = data.ctaText;
            if(data.ctaAnimation === 'pulse') btn.classList.add('animate__animated', 'animate__pulse', 'animate__infinite');
            if(data.ctaAnimation === 'shake') btn.classList.add('animate__animated', 'animate__headShake', 'animate__infinite');

            const formBtn = document.getElementById('formSubmitBtn');
            formBtn.innerHTML = `<i class="fas fa-${data.formCtaIcon} me-2"></i> ${data.formCtaText}`;

            // Offres
            const list = document.getElementById('offersList');
            list.innerHTML = data.offers.map((o,i) => `
                <div class="offer-card ${o.isDefault?'selected':''}" onclick="selOffer(this, ${i})">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <input type="radio" name="off" ${o.isDefault?'checked':''} class="form-check-input me-2" style="transform:scale(1.3)">
                            <div><div class="fw-bold">${o.name}</div><div class="small text-muted">${o.qty} unité(s)</div></div>
                        </div>
                        <div class="fw-bold text-danger">${new Intl.NumberFormat('fr-FR').format(o.price)} FCFA</div>
                    </div>
                </div>
            `).join('');

            // Timer
            if(data.timerEnabled) {
                document.getElementById('timerBar').classList.remove('d-none');
                startTimer(15);
            }

            // WhatsApp
            if(data.whatsappEnabled) {
                document.getElementById('whatsappFooter').classList.remove('d-none');
                document.getElementById('waText').textContent = data.whatsappText || 'WhatsApp';
                document.getElementById('waLink').href = `https://wa.me/${data.whatsappNumber.replace(/\D/g,'')}`;
            }

            // Pixel Init
            if(data.pixelId) console.log(`Pixel ${data.pixelId} Initialized`);
        }

        function selOffer(el, idx) {
            document.querySelectorAll('.offer-card').forEach(c => { c.classList.remove('selected'); c.querySelector('input').checked = false; });
            el.classList.add('selected'); el.querySelector('input').checked = true;
        }
        
        window.openModal = () => { document.getElementById('orderModal').classList.add('active'); document.body.style.overflow='hidden'; }
        window.closeModal = () => { document.getElementById('orderModal').classList.remove('active'); document.body.style.overflow='auto'; }

        function startTimer(m) {
            let t = m*60; const el = document.getElementById('timerCounter');
            setInterval(()=>{ let mn=Math.floor(t/60), sc=t%60; el.textContent=`${mn<10?'0'+mn:mn}:${sc<10?'0'+sc:sc}`; if(t>0)t--; }, 1000);
        }

        window.handleOrderSubmit = function(e) {
            e.preventDefault();
            const name = document.getElementById('inpName').value;
            
            // Pixel Event
            if(pageData.pixelId && pageData.pixelEvent) {
                console.log(`Firing Pixel Event: ${pageData.pixelEvent}`);
            }

            // Thank You Message Logic
            let msg = pageData.thankYouMsg || "Merci {client} !";
            msg = msg.replace('{client}', name).replace('{produit}', pageData.productName);
            
            alert(msg);
            closeModal();
        };
    </script>
</body>
</html>